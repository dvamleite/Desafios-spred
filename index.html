<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Introdução Prática ao TypeScript</title>

    <link rel="stylesheet" href="./index.css">

</head>

<body>

    <header >
        <nav class="menu">
            <ul class="style_menu">
                <li><a href="#desafio_01" >Desafio 01</a></li>
                <li><a href="#desafio_02" >Desafio 02</a></li>
                <li><a href="#desafio_03" >Desafio 03</a></li>
                <li><a href="#desafio_04" >Desafio 04</a></li>
            </ul>
        </nav>
    </header>

    <section id="desafio_01" class="desafio_1 contente">
        <span class="content_space">
            <h2>Como podemos rodar isso em um arquivo .ts sem causar erros?</h2>
            <div class="pergunta">
                <p>
                    <br>let employee = {};<br>
                    employee.code = 10;<br>
                    employee.name = "John";
                </p>
            </div>
        </span>

        <span>
            <h2>Resposta </h2>
            <div class="resposta">
                <p>
                    const funcionario2: {codigo: number, nome: string} = {<br>
                    codigo: 10,<br>
                    nome: 'joao'<br>
                    }
                </p>
            </div>
        </span>

    </section>

    <section id="desafio_02" class="desafio_2 contente">

        <span class="content_space">

            <h2> Como podemos melhorar o esse código usando TS?</h2>

            <div class="pergunta">
                <p>
                    let pessoa1 = {};
                    pessoa1.nome = "maria";
                    pessoa1.idade = 29;
                    pessoa1.profissao = "atriz"

                </p>

                <p>
                    let pessoa2 = {}
                    pessoa2.nome = "roberto";
                    pessoa2.idade = 19;
                    pessoa2.profissao = "Padeiro";
                </p>

                <p>
                    let pessoa3 = {
                    nome: "laura",
                    idade: "32",
                    profissao: "Atriz"
                    };
                </p>

                <p>
                    let pessoa4 = {
                    nome = "carlos",
                    idade = 19,
                    profissao = "padeiro"
                    }
                </p>
            </div>
        </span>

        <h2>Resposta</h2>

        <span>
            <div class="resposta">
                <p>
                    enum Trabalho {
                    Atriz,
                    Padeiro
                    }

                </p>

                <p>
                    type Humano = {
                    nome: string,
                    idade: number,
                    profissao: Trabalho
                    }
                </p>

                <p>
                    let pessoa1: Humano = {
                    nome: 'maria',
                    idade: 29,
                    profissao: Trabalho.Atriz
                    };

                </p>

                <p>
                    let pessoa2: Humano = {
                    nome: 'roberto',
                    idade: 19,
                    profissao: Trabalho.Padeiro
                    };
                </p>

                <p>
                    let pessoa3: Humano = {
                    nome: 'laura',
                    idade: 32,
                    profissao: Trabalho.Atriz
                    };
                </p>

                <p>
                    let pessoa4: Humano = {
                    nome: "carlos",
                    idade: 19,
                    profissao: Trabalho.Padeiro
                    }
                </p>
            </div>
        </span>

    </section>

    <section id="desafio_03" class="desafio_3 contente">

        <span class="content_space">

            <h2> O código abaixo tem alguns erros e não funciona como deveria. Você pode identificar quais são e
                corrigi-los em um arquivo TS?</h2>

            <div class="pergunta">
                <p>
                    let botaoAtualizar = document.getElementById('atualizar-saldo');<br>
                    let botaoLimpar = document.getElementById('limpar-saldo');<br>
                    let soma = document.getElementById('soma');<br>
                    let campoSaldo = document.getElementById('campo-saldo');
                </p><br>

                <p>
                    campoSaldo.innerHTML = 0
                </p><br>

                <p>
                    function somarAoSaldo(soma) {<br>
                    campoSaldo.innerHTML += soma;<br>
                    }
                </p><br>

                <p>
                    function limparSaldo() {
                    campoSaldo.innerHTML = '';
                    }
                </p><br>

                <p>
                    botaoAtualizar.addEventListener('click', function () {<br>
                    somarAoSaldo(soma.value);
                    });
                </p><br>

                <p>
                    botaoLimpar.addEventListener('click', function () {<br>
                    limparSaldo();
                    });

                </p><br>
            </div>
        </span>

        <h2>Resposta</h2>

        <div class="resposta">
            <p>
                let botaoAtualizar = document.getElementById('atualizar-saldo');<br>
                let botaoLimpar = document.getElementById('limpar-saldo');<br>
                let soma = document.getElementById('soma');<br>
                let campoSaldo = document.getElementById('campo-saldo');
            </p><br>

            <p>
                campoSaldo.innerHTML = 0
            </p><br>

            <p>
                function somarAoSaldo(soma) {<br>
                campoSaldo.innerHTML += soma;<br>
                }
            </p><br>

            <p>
                function limparSaldo() {<br>
                campoSaldo.innerHTML = '';<br>
                }
            </p><br>

            <p>
                botaoAtualizar.addEventListener('click', function () {<br>
                somarAoSaldo(soma.value);<br>
                });
            </p><br>

            <p>
                botaoLimpar.addEventListener('click', function () {<br>
                limparSaldo();<br>
                });

            </p><br>
        </div>


        <h2>Exemplo Funcionando</h2>

        <h4>Valor a ser adicionado: <input id="soma"> </h4>
        <div class="box-btn">
            <button id="atualizar-saldo">Atualizar saldo</button>
            <button id="limpar-saldo">Limpar seu saldo</button>
        </div>
        <h1>"Seu saldo é: " <span id="campo-saldo"></span></h1>

    </section>

    <section id="desafio_04" class="desafio_4 contente">

        <span class="content_space">
            <h2>
                Um desenvolvedor tentou criar um projeto que consome a base de dados de filme do TMDB para criar um
                organizador de filmes, mas desistiu
                pois considerou o seu código inviável. Você consegue usar typescript para organizar esse código e a
                partir daí aprimorar o que foi feito?

                <p class="info">
                    A ideia dessa atividade é criar um aplicativo que:
                    - Busca filmes
                    - Apresenta uma lista com os resultados pesquisados
                    - Permite a criação de listas de filmes e a posterior adição de filmes nela
                </p>

                Todas as requisições necessárias para as atividades acima já estão prontas, mas a implementação delas
                ficou pela metade (não vou dar tudo de graça).
                Atenção para o listener do botão login-button que devolve o sessionID do usuário
                É necessário fazer um cadastro no https://www.themoviedb.org/ e seguir a documentação do site para
                entender como gera uma API key https://developers.themoviedb.org/3/getting-started/introduction

            </h2>
            <div class="pergunta">
                <p>
                    var apiKeys = 'cf0a1af050ad8e486ccb2f04d51309a6';<br>
                    let apiKey;<br>
                    let requestToken;<br>
                    let username;<br>
                    let password;<br>
                    let sessionId;<br>
                    let listId = '7101979';<br>

                    let loginButton = document.getElementById('login-button');<br>
                    let searchButton = document.getElementById('search-button');<br>
                    let searchContainer = document.getElementById('search-container');<br>

                    loginButton.addEventListener('click', async () => {<br>
                    await criarRequestToken();<br>
                    await logar();<br>
                    await criarSessao();<br>
                    })<br>

                    searchButton.addEventListener('click', async () => {<br>
                    let lista = document.getElementById("lista");<br>
                    if (lista) {<br>
                    lista.outerHTML = "";<br>
                    }<br>
                    let query = document.getElementById('search').value;<br>
                    let listaDeFilmes = await procurarFilme(query);<br>
                    let ul = document.createElement('ul');<br>
                    ul.id = "lista"<br>
                    for (const item of listaDeFilmes.results) {<br>
                    let li = document.createElement('li');<br>
                    li.appendChild(document.createTextNode(item.original_title))<br>
                    ul.appendChild(li)<br>
                    }<br>
                    console.log(listaDeFilmes);<br>
                    searchContainer.appendChild(ul);<br>
                    })<br>

                    function preencherSenha() {<br>
                    password = document.getElementById('senha').value;<br>
                    validateLoginButton();<br>
                    }<br>

                    function preencherLogin() {<br>
                    username = document.getElementById('login').value;<br>
                    validateLoginButton();<br>
                    }<br>

                    function preencherApi() {<br>
                    apiKey = document.getElementById('api-key').value;<br>
                    validateLoginButton();<br>
                    }<br>

                    function validateLoginButton() {<br>
                    if (password && username && apiKey) {<br>
                    loginButton.disabled = false;<br>
                    } else {<br>
                    loginButton.disabled = true;<br>
                    }
                    }<br>

                    class HttpClient {<br>
                    static async get({url, method, body = null}) {<br>
                    return new Promise((resolve, reject) => {<br>
                    let request = new XMLHttpRequest();<br>
                    request.open(method, url, true);<br>

                    request.onload = () => {<br>
                    if (request.status >= 200 && request.status < 300) { resolve(JSON.parse(request.responseText));
                        }<br>
                        else { reject({ status: request.status, statusText: request.statusText }) } }<br>
                        request.onerror=()=> {<br>
                        reject({<br>
                        status: request.status,<br>
                        statusText: request.statusText<br>
                        })
                        }<br>

                        if (body) {<br>
                        request.setRequestHeader("Content-Type", "application/json;charset=UTF-8");<br>
                        body = JSON.stringify(body);<br>
                        }<br>
                        request.send(body);<br>
                        })
                        }
                        }<br>

                        apiKey = apiKeys;<br>

                        async function procurarFilme(query) {<br>
                        query = encodeURI(query)<br>
                        console.log(query)<br>
                        let result = await HttpClient.get({<br>
                        url: `https://api.themoviedb.org/3/search/movie?api_key=${apiKey}&query=${query}`,<br>
                        method: "GET"<br>
                        })<br>
                        return result<br>
                        }<br>

                        async function adicionarFilme(filmeId) {<br>
                        let result = await HttpClient.get({<br>
                        url: `https://api.themoviedb.org/3/movie/${filmeId}?api_key=${apiKey}&language=en-US`,<br>
                        method: "GET"<br>
                        })<br>
                        console.log(result);<br>
                        }<br>

                        async function criarRequestToken () {<br>
                        let result = await HttpClient.get({<br>
                        url: `https://api.themoviedb.org/3/authentication/token/new?api_key=${apiKey}`,<br>
                        method: "GET"<br>
                        })<br>
                        requestToken = result.request_token<br>
                        }<br>

                        async function logar() {<br>
                        await HttpClient.get({<br>
                        url:
                        `https://api.themoviedb.org/3/authentication/token/validate_with_login?api_key=${apiKey}`,<br>
                        method: "POST",<br>
                        body: {<br>
                        username: `${username}`,<br>
                        password: `${password}`,<br>
                        request_token: `${requestToken}`<br>
                        }
                        })
                        }<br>

                        async function criarSessao() {<br>
                        let result = await HttpClient.get({<br>
                        url:<br>
                        `https://api.themoviedb.org/3/authentication/session/new?api_key=${apiKey}&request_token=${requestToken}`,<br>
                        method: "GET"<br>
                        })<br>
                        sessionId = result.session_id;<br>
                        }<br>

                        async function criarLista(nomeDaLista, descricao) {<br>
                        let result = await HttpClient.get({<br>
                        url: `https://api.themoviedb.org/3/list?api_key=${apiKey}&session_id=${sessionId}`,<br>
                        method: "POST",<br>
                        body: {<br>
                        name: nomeDaLista,<br>
                        description: descricao,<br>
                        language: "pt-br"<br>
                        }
                        })<br>
                        console.log(result);<br>
                        }<br>

                        async function adicionarFilmeNaLista(filmeId, listaId) {<br>
                        let result = await HttpClient.get({<br>
                        url:<br>
                        `https://api.themoviedb.org/3/list/${listaId}/add_item?api_key=${apiKey}&session_id=${sessionId}`,<br>
                        method: "POST",<br>
                        body: {<br>
                        media_id: filmeId<br>
                        }
                        })<br>
                        console.log(result);<br>
                        }<br>

                        async function pegarLista() {<br>
                        let result = await HttpClient.get({<br>
                        url: `https://api.themoviedb.org/3/list/${listId}?api_key=${apiKey}`,<br>
                        method: "GET"<br>
                        })<br>
                        console.log(result);<br>
                        }
                </p>
            </div>
        </span>

        <h2>Resposta</h2>

        <span class="content_space">

            <div class="resposta">
                <p>
                    Em Construcao
                </p>
            </div>
        </span>

        <h2>Exemplo Funcionando</h2>
        <div style="display: flex;">
            <div
                style="display: flex; width: 300px; height: 100px; justify-content: space-between; flex-direction: column;">
                <input id="login" placeholder="Login" onchange="preencherLogin(event)">
                <input id="senha" placeholder="Senha" type="password" onchange="preencherSenha(event)">
                <input id="api-key" placeholder="Api Key" onchange="preencherApi()">
                <button id="login-button" disabled>Login</button>
            </div>
            <div id="search-container" style="margin-left: 20px">
                <input id="search" placeholder="Escreva...">
                <button id="search-button">Pesquisar Filme</button>
            </div>
        </div>

    </section>

</body>
<script src="./src/desafios/desafio3.js" defer></script>
<script src="./src/menu.js" defer></script>

</html>